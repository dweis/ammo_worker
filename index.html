<!DOCTYPE html>
<html>
<head>
  <title>AmmoWorker</title>
  <style>
  html, body, pre#info { width: 100%; height: 100%;}
  </style>
</head>
<body>
  <pre id="info"></pre>
  <script src="js/catiline.js"></script>
  <script src="js/ammo_worker.js"></script>
  <script>
    var el = document.getElementById('info');
    var worker = new AmmoWorker();

    worker.on('ready', function() {
      worker.addRigidBody({
        position: {
          x: 0,
          y: 0,
          z: 0
        },
        quaternion: {
          x: 0,
          y: 0,
          z: 0,
          w: 1
        },
        shape: {
          shape: 'staticplane',
          normal: {
            x: 0,
            y: 1,
            z: 0
          },
          distance: 0
        },
        friction: 0.8,
        restitution: 0.2,
        mass: 0
      });

      for (var i = 0; i < 100; i++) {
        worker.addRigidBody({
          position: {
            x: 0,
            y: 5,
            z: 0
          },
          quaternion: {
            x: 0,
            y: 0,
            z: 0,
            w: 1
          },
          shape: {
            shape: 'box',
            halfExtents: {
              x: 0.1,
              y: 0.1,
              z: 0.1
            }
          },
          friction: 0.8,
          restitution: 0.2,
          mass: 1
        });
      }
    });

    worker.on('error', function(err) {
      throw(err);
    });
    
    worker.on('stats', function(stats) {
      console.log(stats);
    });

    worker.on('update', function(buf) {
      var data = new Float64Array(buf);
      el.innerHTML = '';
      for (var i = 0; i < 10; i++) 
        el.innerHTML += [data[i * 7 + 0], data[ i * 7 + 1 ], data[ i * 7 + 2 ], 
          data[ i * 7 + 3 ], data[ i * 7 + 4 ], data[ i * 7 + 5 ], data[ i * 7 + 6 ]].join(' ') + '\n';

      setTimeout(function() {
        worker.swap(buf, [buf])
      }, 1000/60);
    });

    setTimeout(function() {
      worker.startSimulation();

      setTimeout(function() {
        worker.stopSimulation();
      }, 15000);
    }, 500);
  </script>
</body>
</html>
