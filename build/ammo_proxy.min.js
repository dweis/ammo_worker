/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/** @license MIT License (c) copyright 2011-2013 original author or authors */

/**
 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @author Brian Cavalier
 * @author John Hann
 * @version 2.5.1
 */

//     Underscore.js 1.4.4
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

!function(t,e){"function"==typeof define&&define.amd?define(e):t.AmmoProxy=e()}(this,function(){var t,e,n;return function(i){function r(t,e){return b.call(t,e)}function o(t,e){var n,i,r,o,s,a,c,u,l,h,p=e&&e.split("/"),f=v.map,d=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),t=p.concat(t.split("/")),u=0;u<t.length;u+=1)if(h=t[u],"."===h)t.splice(u,1),u-=1;else if(".."===h){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||d)&&f){for(n=t.split("/"),u=n.length;u>0;u-=1){if(i=n.slice(0,u).join("/"),p)for(l=p.length;l>0;l-=1)if(r=f[p.slice(0,l).join("/")],r&&(r=r[i])){o=r,s=u;break}if(o)break;!a&&d&&d[i]&&(a=d[i],c=u)}!o&&a&&(o=a,s=c),o&&(n.splice(0,s,o),t=n.join("/"))}return t}function s(t,e){return function(){return f.apply(i,_.call(arguments,0).concat([t,e]))}}function a(t){return function(e){return o(e,t)}}function c(t){return function(e){y[t]=e}}function u(t){if(r(g,t)){var e=g[t];delete g[t],x[t]=!0,p.apply(i,e)}if(!r(y,t)&&!r(x,t))throw new Error("No "+t);return y[t]}function l(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function h(t){return function(){return v&&v.config&&v.config[t]||{}}}var p,f,d,m,y={},g={},v={},x={},b=Object.prototype.hasOwnProperty,_=[].slice;d=function(t,e){var n,i=l(t),r=i[0];return t=i[1],r&&(r=o(r,e),n=u(r)),r?t=n&&n.normalize?n.normalize(t,a(e)):o(t,e):(t=o(t,e),i=l(t),r=i[0],t=i[1],r&&(n=u(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:n}},m={require:function(t){return s(t)},exports:function(t){var e=y[t];return"undefined"!=typeof e?e:y[t]={}},module:function(t){return{id:t,uri:"",exports:y[t],config:h(t)}}},p=function(t,e,n,o){var a,l,h,p,f,v,b=[];if(o=o||t,"function"==typeof n){for(e=!e.length&&n.length?["require","exports","module"]:e,f=0;f<e.length;f+=1)if(p=d(e[f],o),l=p.f,"require"===l)b[f]=m.require(t);else if("exports"===l)b[f]=m.exports(t),v=!0;else if("module"===l)a=b[f]=m.module(t);else if(r(y,l)||r(g,l)||r(x,l))b[f]=u(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,s(o,!0),c(l),{}),b[f]=y[l]}h=n.apply(y[t],b),t&&(a&&a.exports!==i&&a.exports!==y[t]?y[t]=a.exports:h===i&&v||(y[t]=h))}else t&&(y[t]=n)},t=e=f=function(t,e,n,r,o){return"string"==typeof t?m[t]?m[t](e):u(d(t,e).f):(t.splice||(v=t,e.splice?(t=e,e=n,n=null):t=i),e=e||function(){},"function"==typeof n&&(n=r,r=o),r?p(i,t,e,n):setTimeout(function(){p(i,t,e,n)},4),f)},f.config=function(t){return v=t,v.deps&&f(v.deps,v.callback),f},n=function(t,e,n){e.splice||(n=e,e=[]),r(y,t)||r(g,t)||(g[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("vendor/almond",function(){}),function(t,e){t("when",["require"],function(t){function n(t,e,n,r){return i(t).then(e,n,r)}function i(t){return t instanceof r?t:o(t)}function r(t,e){this._message=t,this.inspect=e}function o(t){return c(function(e){e(t)})}function s(t){return n(t,p)}function a(){function t(t,r,s){e.resolve=e.resolver.resolve=function(e){return i?o(e):(i=!0,t(e),n)},e.reject=e.resolver.reject=function(t){return i?o(p(t)):(i=!0,r(t),n)},e.notify=e.resolver.notify=function(t){return s(t),t}}var e,n,i;return e={promise:q,resolve:q,reject:q,notify:q,resolver:{resolve:q,reject:q,notify:q}},e.promise=n=c(t),e}function c(t){return u(t,Z.PromiseStatus&&Z.PromiseStatus())}function u(t,e){function n(t,e,n,i){function r(r){r._message(t,e,n,i)}h?h.push(r):E(function(){r(u)})}function i(){return u?u.inspect():R()}function o(t){if(h){var n=h;h=q,E(function(){u=m(c,t),e&&x(u,e),l(n,u)})}}function s(t){o(p(t))}function a(t){if(h){var e=h;E(function(){l(e,d(t))})}}var c,u,h=[];c=new r(n,i),c._status=e;try{t(o,s,a)}catch(f){s(f)}return c}function l(t,e){for(var n=0;n<t.length;n++)t[n](e)}function h(t){return f(new g(t),function(){return S(t)})}function p(t){return f(new v(t),function(){return z(t)})}function f(t,e){return new r(function(e,n,i){try{i(t[e].apply(t,n))}catch(r){i(p(r))}},e)}function d(t){return new r(function(e,n,i,r){var o=n[2];try{r("function"==typeof o?o(t):t)}catch(s){r(s)}})}function m(t,e){if(e===t)return p(new TypeError);if(e instanceof r)return e;try{var n=e===Object(e)&&e.then;return"function"==typeof n?y(n,e):h(e)}catch(i){return p(i)}}function y(t,e){return c(function(n,i){j(t,e,n,i)})}function g(t){this.value=t}function v(t){this.reason=t}function x(t,e){function n(){e.fulfilled()}function i(t){e.rejected(t)}t.then(n,i)}function b(t){return t&&"function"==typeof t.then}function _(t,e,i,r,o){return n(t,function(t){function s(i,r,o){function s(t){f(t)}function a(t){p(t)}var c,u,l,h,p,f,d,m;if(d=t.length>>>0,c=Math.max(0,Math.min(e,d)),l=[],u=d-c+1,h=[],c)for(f=function(t){h.push(t),--u||(p=f=F,r(h))},p=function(t){l.push(t),--c||(p=f=F,i(l))},m=0;d>m;++m)m in t&&n(t[m],a,s,o);else i(l)}return c(s).then(i,r,o)})}function w(t,e,n,i){function r(t){return e?e(t[0]):t[0]}return _(t,1,r,n,i)}function I(t,e,n,i){return B(t,F).then(e,n,i)}function V(){return B(arguments,F)}function A(t){return B(t,S,z)}function T(t,e){return B(t,e)}function B(t,e,i){return n(t,function(t){function r(r,o,s){function a(t,a){n(t,e,i).then(function(t){c[a]=t,--l||r(c)},o,s)}var c,u,l,h;if(l=u=t.length>>>0,c=[],!l)return r(c),void 0;for(h=0;u>h;h++)h in t?a(t[h],h):--l}return u(r)})}function C(t,e){var i=j(k,arguments,1);return n(t,function(t){var r;return r=t.length,i[0]=function(t,i,o){return n(t,function(t){return n(i,function(n){return e(t,n,o,r)})})},W.apply(t,i)})}function S(t){return{state:"fulfilled",value:t}}function z(t){return{state:"rejected",reason:t}}function R(){return{state:"pending"}}function E(t){1===L.push(t)&&P(O)}function O(){l(L),L=[]}function F(t){return t}n.promise=c,n.resolve=o,n.reject=s,n.defer=a,n.join=V,n.all=I,n.map=T,n.reduce=C,n.settle=A,n.any=w,n.some=_,n.isPromise=b,n.isPromiseLike=b,r.prototype={then:function(){var t,e;return t=arguments,e=this._message,u(function(n,i,r){e("when",t,n,r)},this._status&&this._status.observed())},otherwise:function(t){return this.then(q,t)},ensure:function(t){function e(){return o(t())}return"function"==typeof t?this.then(e,e).yield(this):this},yield:function(t){return this.then(function(){return t})},tap:function(t){return this.then(t).yield(this)},spread:function(t){return this.then(function(e){return I(e,function(e){return t.apply(q,e)})})},always:function(t,e){return this.then(t,t,e)}},g.prototype.when=function(t){return"function"==typeof t?t(this.value):this.value},v.prototype.when=function(t,e){if("function"==typeof e)return e(this.reason);throw this.reason};var W,k,j,P,L,M,D,X,Y,Z,N,H,q;if(N=t,L=[],M=e.setTimeout,Z="undefined"!=typeof console?console:n,"object"==typeof process&&process.nextTick)P=process.nextTick;else if(H=e.MutationObserver||e.WebKitMutationObserver)P=function(t,e,n){var i=t.createElement("div");return new e(n).observe(i,{attributes:!0}),function(){i.setAttribute("x","x")}}(document,H,O);else try{P=N("vertx").runOnLoop||N("vertx").runOnContext}catch(G){P=function(t){M(t,0)}}return D=Function.prototype,X=D.call,j=D.bind?X.bind(X):function(t,e){return t.apply(e,k.call(arguments,2))},Y=[],k=Y.slice,W=Y.reduce||function(t){var e,n,i,r,o;if(o=0,e=Object(this),r=e.length>>>0,n=arguments,n.length<=1)for(;;){if(o in e){i=e[o++];break}if(++o>=r)throw new TypeError}else i=n[1];for(;r>o;++o)o in e&&(i=t(i,e[o],o,e));return i},n})}("function"==typeof n&&n.amd?n:function(t){module.exports=t(e)},this),function(){var t=this,e=t._,i={},r=Array.prototype,o=Object.prototype,s=Function.prototype,a=r.push,c=r.slice,u=r.concat,l=o.toString,h=o.hasOwnProperty,p=r.forEach,f=r.map,d=r.reduce,m=r.reduceRight,y=r.filter,g=r.every,v=r.some,x=r.indexOf,b=r.lastIndexOf,_=Array.isArray,w=Object.keys,I=s.bind,V=function(t){return t instanceof V?t:this instanceof V?(this._wrapped=t,void 0):new V(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=V),exports._=V):t._=V,V.VERSION="1.4.4";var A=V.each=V.forEach=function(t,e,n){if(null!=t)if(p&&t.forEach===p)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,o=t.length;o>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var s in t)if(V.has(t,s)&&e.call(n,t[s],s,t)===i)return};V.map=V.collect=function(t,e,n){var i=[];return null==t?i:f&&t.map===f?t.map(e,n):(A(t,function(t,r,o){i[i.length]=e.call(n,t,r,o)}),i)};var T="Reduce of empty array with no initial value";V.reduce=V.foldl=V.inject=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),d&&t.reduce===d)return i&&(e=V.bind(e,i)),r?t.reduce(e,n):t.reduce(e);if(A(t,function(t,o,s){r?n=e.call(i,n,t,o,s):(n=t,r=!0)}),!r)throw new TypeError(T);return n},V.reduceRight=V.foldr=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),m&&t.reduceRight===m)return i&&(e=V.bind(e,i)),r?t.reduceRight(e,n):t.reduceRight(e);var o=t.length;if(o!==+o){var s=V.keys(t);o=s.length}if(A(t,function(a,c,u){c=s?s[--o]:--o,r?n=e.call(i,n,t[c],c,u):(n=t[c],r=!0)}),!r)throw new TypeError(T);return n},V.find=V.detect=function(t,e,n){var i;return B(t,function(t,r,o){return e.call(n,t,r,o)?(i=t,!0):void 0}),i},V.filter=V.select=function(t,e,n){var i=[];return null==t?i:y&&t.filter===y?t.filter(e,n):(A(t,function(t,r,o){e.call(n,t,r,o)&&(i[i.length]=t)}),i)},V.reject=function(t,e,n){return V.filter(t,function(t,i,r){return!e.call(n,t,i,r)},n)},V.every=V.all=function(t,e,n){e||(e=V.identity);var r=!0;return null==t?r:g&&t.every===g?t.every(e,n):(A(t,function(t,o,s){return(r=r&&e.call(n,t,o,s))?void 0:i}),!!r)};var B=V.some=V.any=function(t,e,n){e||(e=V.identity);var r=!1;return null==t?r:v&&t.some===v?t.some(e,n):(A(t,function(t,o,s){return r||(r=e.call(n,t,o,s))?i:void 0}),!!r)};V.contains=V.include=function(t,e){return null==t?!1:x&&t.indexOf===x?-1!=t.indexOf(e):B(t,function(t){return t===e})},V.invoke=function(t,e){var n=c.call(arguments,2),i=V.isFunction(e);return V.map(t,function(t){return(i?e:t[e]).apply(t,n)})},V.pluck=function(t,e){return V.map(t,function(t){return t[e]})},V.where=function(t,e,n){return V.isEmpty(e)?n?null:[]:V[n?"find":"filter"](t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},V.findWhere=function(t,e){return V.where(t,e,!0)},V.max=function(t,e,n){if(!e&&V.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&V.isEmpty(t))return-1/0;var i={computed:-1/0,value:-1/0};return A(t,function(t,r,o){var s=e?e.call(n,t,r,o):t;s>=i.computed&&(i={value:t,computed:s})}),i.value},V.min=function(t,e,n){if(!e&&V.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&V.isEmpty(t))return 1/0;var i={computed:1/0,value:1/0};return A(t,function(t,r,o){var s=e?e.call(n,t,r,o):t;s<i.computed&&(i={value:t,computed:s})}),i.value},V.shuffle=function(t){var e,n=0,i=[];return A(t,function(t){e=V.random(n++),i[n-1]=i[e],i[e]=t}),i};var C=function(t){return V.isFunction(t)?t:function(e){return e[t]}};V.sortBy=function(t,e,n){var i=C(e);return V.pluck(V.map(t,function(t,e,r){return{value:t,index:e,criteria:i.call(n,t,e,r)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return t.index<e.index?-1:1}),"value")};var S=function(t,e,n,i){var r={},o=C(e||V.identity);return A(t,function(e,s){var a=o.call(n,e,s,t);i(r,a,e)}),r};V.groupBy=function(t,e,n){return S(t,e,n,function(t,e,n){(V.has(t,e)?t[e]:t[e]=[]).push(n)})},V.countBy=function(t,e,n){return S(t,e,n,function(t,e){V.has(t,e)||(t[e]=0),t[e]++})},V.sortedIndex=function(t,e,n,i){n=null==n?V.identity:C(n);for(var r=n.call(i,e),o=0,s=t.length;s>o;){var a=o+s>>>1;n.call(i,t[a])<r?o=a+1:s=a}return o},V.toArray=function(t){return t?V.isArray(t)?c.call(t):t.length===+t.length?V.map(t,V.identity):V.values(t):[]},V.size=function(t){return null==t?0:t.length===+t.length?t.length:V.keys(t).length},V.first=V.head=V.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:c.call(t,0,e)},V.initial=function(t,e,n){return c.call(t,0,t.length-(null==e||n?1:e))},V.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:c.call(t,Math.max(t.length-e,0))},V.rest=V.tail=V.drop=function(t,e,n){return c.call(t,null==e||n?1:e)},V.compact=function(t){return V.filter(t,V.identity)};var z=function(t,e,n){return A(t,function(t){V.isArray(t)?e?a.apply(n,t):z(t,e,n):n.push(t)}),n};V.flatten=function(t,e){return z(t,e,[])},V.without=function(t){return V.difference(t,c.call(arguments,1))},V.uniq=V.unique=function(t,e,n,i){V.isFunction(e)&&(i=n,n=e,e=!1);var r=n?V.map(t,n,i):t,o=[],s=[];return A(r,function(n,i){(e?i&&s[s.length-1]===n:V.contains(s,n))||(s.push(n),o.push(t[i]))}),o},V.union=function(){return V.uniq(u.apply(r,arguments))},V.intersection=function(t){var e=c.call(arguments,1);return V.filter(V.uniq(t),function(t){return V.every(e,function(e){return V.indexOf(e,t)>=0})})},V.difference=function(t){var e=u.apply(r,c.call(arguments,1));return V.filter(t,function(t){return!V.contains(e,t)})},V.zip=function(){for(var t=c.call(arguments),e=V.max(V.pluck(t,"length")),n=new Array(e),i=0;e>i;i++)n[i]=V.pluck(t,""+i);return n},V.object=function(t,e){if(null==t)return{};for(var n={},i=0,r=t.length;r>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},V.indexOf=function(t,e,n){if(null==t)return-1;var i=0,r=t.length;if(n){if("number"!=typeof n)return i=V.sortedIndex(t,e),t[i]===e?i:-1;i=0>n?Math.max(0,r+n):n}if(x&&t.indexOf===x)return t.indexOf(e,n);for(;r>i;i++)if(t[i]===e)return i;return-1},V.lastIndexOf=function(t,e,n){if(null==t)return-1;var i=null!=n;if(b&&t.lastIndexOf===b)return i?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var r=i?n:t.length;r--;)if(t[r]===e)return r;return-1},V.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=0,o=new Array(i);i>r;)o[r++]=t,t+=n;return o},V.bind=function(t,e){if(t.bind===I&&I)return I.apply(t,c.call(arguments,1));var n=c.call(arguments,2);return function(){return t.apply(e,n.concat(c.call(arguments)))}},V.partial=function(t){var e=c.call(arguments,1);return function(){return t.apply(this,e.concat(c.call(arguments)))}},V.bindAll=function(t){var e=c.call(arguments,1);return 0===e.length&&(e=V.functions(t)),A(e,function(e){t[e]=V.bind(t[e],t)}),t},V.memoize=function(t,e){var n={};return e||(e=V.identity),function(){var i=e.apply(this,arguments);return V.has(n,i)?n[i]:n[i]=t.apply(this,arguments)}},V.delay=function(t,e){var n=c.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},V.defer=function(t){return V.delay.apply(V,[t,1].concat(c.call(arguments,1)))},V.throttle=function(t,e){var n,i,r,o,s=0,a=function(){s=new Date,r=null,o=t.apply(n,i)};return function(){var c=new Date,u=e-(c-s);return n=this,i=arguments,0>=u?(clearTimeout(r),r=null,s=c,o=t.apply(n,i)):r||(r=setTimeout(a,u)),o}},V.debounce=function(t,e,n){var i,r;return function(){var o=this,s=arguments,a=function(){i=null,n||(r=t.apply(o,s))},c=n&&!i;return clearTimeout(i),i=setTimeout(a,e),c&&(r=t.apply(o,s)),r}},V.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},V.wrap=function(t,e){return function(){var n=[t];return a.apply(n,arguments),e.apply(this,n)}},V.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},V.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},V.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)V.has(t,n)&&(e[e.length]=n);return e},V.values=function(t){var e=[];for(var n in t)V.has(t,n)&&e.push(t[n]);return e},V.pairs=function(t){var e=[];for(var n in t)V.has(t,n)&&e.push([n,t[n]]);return e},V.invert=function(t){var e={};for(var n in t)V.has(t,n)&&(e[t[n]]=n);return e},V.functions=V.methods=function(t){var e=[];for(var n in t)V.isFunction(t[n])&&e.push(n);return e.sort()},V.extend=function(t){return A(c.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},V.pick=function(t){var e={},n=u.apply(r,c.call(arguments,1));return A(n,function(n){n in t&&(e[n]=t[n])}),e},V.omit=function(t){var e={},n=u.apply(r,c.call(arguments,1));for(var i in t)V.contains(n,i)||(e[i]=t[i]);return e},V.defaults=function(t){return A(c.call(arguments,1),function(e){if(e)for(var n in e)null==t[n]&&(t[n]=e[n])}),t},V.clone=function(t){return V.isObject(t)?V.isArray(t)?t.slice():V.extend({},t):t},V.tap=function(t,e){return e(t),t};var R=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof V&&(t=t._wrapped),e instanceof V&&(e=e._wrapped);var r=l.call(t);if(r!=l.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=n.length;o--;)if(n[o]==t)return i[o]==e;n.push(t),i.push(e);var s=0,a=!0;if("[object Array]"==r){if(s=t.length,a=s==e.length)for(;s--&&(a=R(t[s],e[s],n,i)););}else{var c=t.constructor,u=e.constructor;if(c!==u&&!(V.isFunction(c)&&c instanceof c&&V.isFunction(u)&&u instanceof u))return!1;for(var h in t)if(V.has(t,h)&&(s++,!(a=V.has(e,h)&&R(t[h],e[h],n,i))))break;if(a){for(h in e)if(V.has(e,h)&&!s--)break;a=!s}}return n.pop(),i.pop(),a};V.isEqual=function(t,e){return R(t,e,[],[])},V.isEmpty=function(t){if(null==t)return!0;if(V.isArray(t)||V.isString(t))return 0===t.length;for(var e in t)if(V.has(t,e))return!1;return!0},V.isElement=function(t){return!(!t||1!==t.nodeType)},V.isArray=_||function(t){return"[object Array]"==l.call(t)},V.isObject=function(t){return t===Object(t)},A(["Arguments","Function","String","Number","Date","RegExp"],function(t){V["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),V.isArguments(arguments)||(V.isArguments=function(t){return!(!t||!V.has(t,"callee"))}),"function"!=typeof/./&&(V.isFunction=function(t){return"function"==typeof t}),V.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},V.isNaN=function(t){return V.isNumber(t)&&t!=+t},V.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},V.isNull=function(t){return null===t},V.isUndefined=function(t){return void 0===t},V.has=function(t,e){return h.call(t,e)},V.noConflict=function(){return t._=e,this},V.identity=function(t){return t},V.times=function(t,e,n){for(var i=Array(t),r=0;t>r;r++)i[r]=e.call(n,r);return i},V.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var E={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};E.unescape=V.invert(E.escape);var O={escape:new RegExp("["+V.keys(E.escape).join("")+"]","g"),unescape:new RegExp("("+V.keys(E.unescape).join("|")+")","g")};V.each(["escape","unescape"],function(t){V[t]=function(e){return null==e?"":(""+e).replace(O[t],function(e){return E[t][e]})}}),V.result=function(t,e){if(null==t)return null;var n=t[e];return V.isFunction(n)?n.call(t):n},V.mixin=function(t){A(V.functions(t),function(e){var n=V[e]=t[e];V.prototype[e]=function(){var t=[this._wrapped];return a.apply(t,arguments),P.call(this,n.apply(V,t))}})};var F=0;V.uniqueId=function(t){var e=++F+"";return t?t+e:e},V.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var W=/(.)^/,k={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;V.template=function(t,e,n){var i;n=V.defaults({},n,V.templateSettings);var r=new RegExp([(n.escape||W).source,(n.interpolate||W).source,(n.evaluate||W).source].join("|")+"|$","g"),o=0,s="__p+='";t.replace(r,function(e,n,i,r,a){return s+=t.slice(o,a).replace(j,function(t){return"\\"+k[t]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(s+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),r&&(s+="';\n"+r+"\n__p+='"),o=a+e.length,e}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{i=new Function(n.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(e)return i(e,V);var c=function(t){return i.call(this,t,V)};return c.source="function("+(n.variable||"obj")+"){\n"+s+"}",c},V.chain=function(t){return V(t).chain()};var P=function(t){return this._chain?V(t).chain():t};V.mixin(V),A(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=r[t];V.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],P.call(this,n)}}),A(["concat","join","slice"],function(t){var e=r[t];V.prototype[t]=function(){return P.call(this,e.apply(this._wrapped,arguments))}}),V.extend(V.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof n&&n.amd&&n("underscore",[],function(){return V})}.call(this),n("ammo_worker_api",[],function(){function t(t){this.maxBodies=1e3,this.maxVehicles=32,this.maxWheelsPerVehicle=8;for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}return t.prototype={collisionFlags:{CF_STATIC_OBJECT:1,CF_KINEMATIC_OBJECT:2,CF_NO_CONTACT_RESPONSE:4,CF_CUSTOM_MATERIAL_CALLBACK:8,CF_CHARACTER_OBJECT:16,CF_DISABLE_VISUALIZE_OBJECT:32,CF_DISABLE_SPU_COLLISION_PROCESSING:64},activationStates:{ACTIVE_TAG:1,ISLAND_SLEEPING:2,WANTS_DEACTIVATION:3,DISABLE_DEACTIVATION:4,DISABLE_SIMULATION:5},init:function(){var t=8*7*this.maxBodies+8*7*this.maxVehicles*this.maxWheelsPerVehicle;importScripts("http://assets.verold.com/verold_api/lib/ammo.js"),this.tmpVec=[new Ammo.btVector3,new Ammo.btVector3,new Ammo.btVector3,new Ammo.btVector3],this.tmpQuaternion=[new Ammo.btQuaternion,new Ammo.btQuaternion],this.tmpTrans=[new Ammo.btTransform,new Ammo.btTransform],this.bodies=[],this.vehicles=[],this.constraints=[],this.ghosts=[],this.collisionConfiguration=new Ammo.btDefaultCollisionConfiguration,this.dispatcher=new Ammo.btCollisionDispatcher(this.collisionConfiguration),this.overlappingPairCache=new Ammo.btDbvtBroadphase,this.solver=new Ammo.btSequentialImpulseConstraintSolver,this.dynamicsWorld=new Ammo.btDiscreteDynamicsWorld(this.dispatcher,this.overlappingPairCache,this.solver,this.collisionConfiguration),this.ghostPairCallback=new Ammo.btGhostPairCallback,this.dynamicsWorld.getPairCache().setInternalGhostPairCallback(this.ghostPairCallback),this.buffers=[new ArrayBuffer(t),new ArrayBuffer(t),new ArrayBuffer(t)],this.fire("ready")},getStats:function(t,e){return e({totalTime:this.totalTime,frames:this.frames,fps:this.fps})},startSimulation:function(){var t=this,e=Date.now();t.totalTime=0,t.frames=0,this.simulationTimerId=setInterval(function(){var n,i,r,o,s,a=Date.now(),c=(a-e)/1e3;if(t.dynamicsWorld.stepSimulation(c,t.iterations,t.step),t.buffers.length>0&&(i=new Float64Array(t.buffers.pop())),i&&i.buffer instanceof ArrayBuffer){for(r in t.bodies)t.bodies[r]&&(t.tmpTrans[0].setIdentity(),t.bodies[r].getMotionState().getWorldTransform(t.tmpTrans[0]),i[7*r+0]=t.tmpTrans[0].getOrigin().x(),i[7*r+1]=t.tmpTrans[0].getOrigin().y(),i[7*r+2]=t.tmpTrans[0].getOrigin().z(),i[7*r+3]=t.tmpTrans[0].getRotation().x(),i[7*r+4]=t.tmpTrans[0].getRotation().y(),i[7*r+5]=t.tmpTrans[0].getRotation().z(),i[7*r+6]=t.tmpTrans[0].getRotation().w());for(r in t.vehicles)if(t.vehicles[r])for(n=t.vehicles[r],o=0;o<n.getNumWheels()+1;o++)t.tmpTrans[0]=n.getWheelInfo(o).get_m_worldTransform(),s=7*t.maxBodies+7*r*t.maxWheelsPerVehicle+7*o,i[s+0]=t.tmpTrans[0].getOrigin().x(),i[s+1]=t.tmpTrans[0].getOrigin().y(),i[s+2]=t.tmpTrans[0].getOrigin().z(),i[s+3]=t.tmpTrans[0].getRotation().x(),i[s+4]=t.tmpTrans[0].getRotation().y(),i[s+5]=t.tmpTrans[0].getRotation().z(),i[s+6]=t.tmpTrans[0].getRotation().w();t.ghosts.forEach(function(t){{var e=Ammo.castObject(t.getOverlappingPairCache(),Ammo.btOverlappingPairCache);e.getNumOverlappingPairs()}}.bind(this)),t.fire("update",i.buffer,[i.buffer]),t.frames++,e=a,t.totalTime+=c,t.fps=Math.round(t.frames/t.totalTime)}},1e3*this.step)},stopSimulation:function(){this.simulationTimerId&&clearInterval(this.simulationTimerId)},swap:function(t){t instanceof ArrayBuffer&&this.buffers.push(t)},setStep:function(t){this.step=t},setIterations:function(t){this.iterations=t},setGravity:function(t){this.tmpVec[0].setX(t.x),this.tmpVec[0].setY(t.y),this.tmpVec[0].setZ(t.z),this.dynamicsWorld.setGravity(this.tmpVec[0])},_createCompoundShape:function(t){var e,n,i=new Ammo.btCompoundShape,r=this.tmpTrans[0];if(t.children&&t.children.length)for(var o in t.children)t.children.hasOwnProperty(o)&&(e=t.children[o],n=this._createShape(e),r.setIdentity(),this.tmpVec[0].setX(e.localTransform.position.x),this.tmpVec[0].setY(e.localTransform.position.y),this.tmpVec[0].setZ(e.localTransform.position.z),r.setOrigin(this.tmpVec[0]),this.tmpQuaternion[0].setX(e.localTransform.rotation.x),this.tmpQuaternion[0].setY(e.localTransform.rotation.y),this.tmpQuaternion[0].setZ(e.localTransform.rotation.z),this.tmpQuaternion[0].setW(e.localTransform.rotation.w),r.setRotation(this.tmpQuaternion[0]),i.addChildShape(r,n));return i},_createConvexHullMeshShape:function(t){var e;if(!t.vertices)throw new Error("You must supply a list of vertices!");e=new Ammo.btConvexHullShape;for(var n=0;n<t.vertices.length/3;n+=3)this.tmpVec[0].setX(t.vertices[3*n+0]),this.tmpVec[0].setY(t.vertices[3*n+1]),this.tmpVec[0].setZ(t.vertices[3*n+2]),e.addPoint(this.tmpVec[0]);return e},_createTriangleMeshShape:function(t,e){var n,i,r;if(!t.triangles)throw new Error("You must supply a list of triangles!");switch(e){case"bvh":r="btBvhTriangleMeshShape";break;case"convex":r="btConvexTriangleMeshShape";break;default:throw new Error("You must supply a valid mesh type!")}for(i=new Ammo.btTriangleMesh(!0,!0),n=0;n<t.triangles.length/9;n++)this.tmpVec[0].setX(t.triangles[9*n+0]),this.tmpVec[0].setY(t.triangles[9*n+1]),this.tmpVec[0].setZ(t.triangles[9*n+2]),this.tmpVec[1].setX(t.triangles[9*n+3]),this.tmpVec[1].setY(t.triangles[9*n+4]),this.tmpVec[1].setZ(t.triangles[9*n+5]),this.tmpVec[2].setX(t.triangles[9*n+6]),this.tmpVec[2].setY(t.triangles[9*n+7]),this.tmpVec[2].setZ(t.triangles[9*n+8]),i.addTriangle(this.tmpVec[0],this.tmpVec[1],this.tmpVec[2],!1);return new Ammo[r](i,!0,!0)},_createShape:function(t){var e;switch(t.shape){case"box":this.tmpVec[0].setX(t.halfExtents.x),this.tmpVec[0].setY(t.halfExtents.y),this.tmpVec[0].setZ(t.halfExtents.z),e=new Ammo.btBoxShape(this.tmpVec[0]);break;case"sphere":e=new Ammo.btSphereShape(t.radius);break;case"staticplane":this.tmpVec[0].setX(t.normal.x),this.tmpVec[0].setY(t.normal.y),this.tmpVec[0].setZ(t.normal.z),e=new Ammo.btStaticPlaneShape(this.tmpVec[0],t.distance);break;case"cylinder":this.tmpVec[0].setX(t.width),this.tmpVec[0].setY(t.height),this.tmpVec[0].setZ(t.depth),e=new Ammo.btCylinderShape(this.tmpVec[0]);break;case"capsule":e=new Ammo.btCapsuleShape(t.radius,t.height);break;case"cone":e=new Ammo.btConeShape(t.radius,t.height);break;case"compound":e=this._createCompoundShape(t);break;case"convex_hull_mesh":e=this._createConvexHullMeshShape(t);break;case"convex_triangle_mesh":e=this._createTriangleMeshShape(t,"convex");break;case"bvh_triangle_mesh":e=this._createTriangleMeshShape(t,"bvh");break;default:return console.error("Unknown shape: "+t.shape)}return e},Broadphase_aabbTest:function(t,e){var n=this;this.aabbCallback||(this.aabbCallback=new Ammo.ConcreteBroadphaseAabbCallback,this.aabbCallback.bodies=[],function(){Ammo.customizeVTable(n.aabbCallback,[{original:Ammo.ConcreteBroadphaseAabbCallback.prototype.process,replacement:function(t,e){var n=Ammo.wrapPointer(e,Ammo.btBroadphaseProxy),i=Ammo.wrapPointer(n.get_m_clientObject(),Ammo.btRigidBody),r=Ammo.wrapPointer(t,Ammo.ConcreteBroadphaseAabbCallback);return i.id&&r.bodies.push(i.id),!0}}])}()),this.tmpVec[0].setX(t.min.x),this.tmpVec[0].setY(t.min.y),this.tmpVec[0].setZ(t.min.z),this.tmpVec[1].setX(t.max.x),this.tmpVec[1].setY(t.max.y),this.tmpVec[1].setZ(t.max.z),this.aabbCallback.bodies=[],this.dynamicsWorld.getBroadphase().aabbTest(this.tmpVec[0],this.tmpVec[1],this.aabbCallback),e(this.aabbCallback.bodies)},Vehicle_create:function(t,e){var n,i=new Ammo.btVehicleTuning,r=this.bodies[t.bodyId];if(!r)return console.error("could not find body");t.tuning&&(t.tuning.suspensionStiffness&&i.set_m_suspensionStiffness(t.tuning.suspensionStiffness),t.tuning.suspensionCompression&&i.set_m_suspensionCompression(t.tuning.suspensionCompression),t.tuning.suspensionDamping&&i.set_m_suspensionDamping(t.tuning.suspensionDamping),t.tuning.maxSuspensionTravelCm&&i.set_m_maxSuspensionTravelCm(t.tuning.maxSuspensionTravelCm),t.tuning.maxSuspensionForce&&i.set_m_maxSuspensionForce(t.tuning.maxSuspensionForce),t.tuning.frictionSlip&&i.set_m_frictionSlip(t.tuning.frictionSlip)),n=new Ammo.btRaycastVehicle(i,r,new Ammo.btDefaultVehicleRaycaster(this.dynamicsWorld)),n.tuning=i,r.setActivationState(this.activationStates.DISABLE_DEACTIVATION),n.setCoordinateSystem(0,1,2),this.dynamicsWorld.addVehicle(n);var o=this.vehicles.push(n)-1;n.id=o,"function"==typeof e&&e(o)},Vehicle_addWheel:function(t,e){var n=this.vehicles[t.vehicleId];if(void 0!==n){var i=n.tuning,r=this.tmpVec[0],o=this.tmpVec[1],s=this.tmpVec[2];"object"==typeof t.tuning&&(i=new Ammo.btVehicleTuning,t.tuning.suspensionStiffness&&i.set_m_suspensionStiffness(t.tuning.suspensionStiffness),t.tuning.suspensionCompression&&i.set_m_suspensionCompression(t.tuning.suspensionCompression),t.tuning.suspensionDamping&&i.set_m_suspensionDamping(t.tuning.suspensionDamping),t.tuning.maxSuspensionTravelCm&&i.set_m_maxSuspensionTravelCm(t.tuning.maxSuspensionTravelCm),t.tuning.maxSuspensionForce&&i.set_m_maxSuspensionForce(t.tuning.maxSuspensionForce),t.tuning.frictionSlip&&i.set_m_frictionSlip(t.tuning.frictionSlip)),r.setX(t.connectionPoint.x),r.setY(t.connectionPoint.y),r.setZ(t.connectionPoint.z),o.setX(t.wheelDirection.x),o.setY(t.wheelDirection.y),o.setZ(t.wheelDirection.z),s.setX(t.wheelAxle.x),s.setY(t.wheelAxle.y),s.setZ(t.wheelAxle.z),n.addWheel(r,o,s,t.suspensionRestLength,t.wheelRadius,i,t.isFrontWheel),"function"==typeof e&&e(n.getNumWheels()-1)}},Vehicle_setSteeringValue:function(t){var e=this.vehicles[t.vehicleId];e&&this.vehicles[t.vehicleId].setSteeringValue(t.steeringValue,t.wheelIndex)},Vehicle_setBrake:function(t){var e=this.vehicles[t.vehicleId];e&&this.vehicles[t.vehicleId].setBrake(t.brake,t.wheelIndex)},Vehicle_setWheelInfo:function(t){var e,n=this.vehicles[t.vehicleId];if(n){e=this.vehicles[t.vehicleId].getWheelInfo(t.wheelIndex);for(var i in t.properties)t.properties.hasOwnProperty(i)&&e["set_m_"+i](t.properties[i])}},Vehicle_applyEngineForce:function(t){var e=this.vehicles[t.vehicleId];e&&this.vehicles[t.vehicleId].applyEngineForce(t.force,t.wheelIndex)},Point2PointConstraint_create:function(t,e){var n,i,r=this.bodies[t.rigidBodyIdA],o="undefined"!=typeof t.rigidBodyIdB&&this.bodies[t.rigidBodyIdB];r&&(this.tmpVec[0].setX(t.pivotA.x),this.tmpVec[0].setY(t.pivotA.y),this.tmpVec[0].setZ(t.pivotA.z),o?(o=this.bodies[t.rigidBodyIdB],this.tmpVec[1].setX(t.pivotB.x),this.tmpVec[1].setY(t.pivotB.y),this.tmpVec[1].setZ(t.pivotB.z),n=new Ammo.btPoint2PointConstraint(r,o,this.tmpVec[0],this.tmpVec[1])):n=new Ammo.btPoint2PointConstraint(r,o),i=this.constraints.push(n)-1,this.dynamicsWorld.addConstraint(n),n.enableFeedback(),"function"==typeof e&&e(i))},SliderConstraint_create:function(t,e){var n,i,r=this.bodies[t.rigidBodyIdA],o="undefined"!=typeof t.rigidBodyIdB&&this.bodies[t.rigidBodyIdB];if(r){var s=new Ammo.btTransform;if(this.tmpVec[0].setX(t.frameInA.position.x),this.tmpVec[0].setY(t.frameInA.position.y),this.tmpVec[0].setZ(t.frameInA.position.z),this.tmpQuaternion[0].setX(t.frameInA.rotation.x),this.tmpQuaternion[0].setY(t.frameInA.rotation.y),this.tmpQuaternion[0].setZ(t.frameInA.rotation.z),this.tmpQuaternion[0].setW(t.frameInA.rotation.w),s.setOrigin(this.tmpVec[0]),s.setRotation(this.tmpQuaternion[0]),o){var a=new Ammo.btTransform;this.tmpVec[1].setX(t.frameInB.position.x),this.tmpVec[1].setY(t.frameInB.position.y),this.tmpVec[1].setZ(t.frameInB.position.z),this.tmpQuaternion[1].setX(t.frameInB.rotation.x),this.tmpQuaternion[1].setY(t.frameInB.rotation.y),this.tmpQuaternion[1].setZ(t.frameInB.rotation.z),this.tmpQuaternion[1].setW(t.frameInB.rotation.w),a.setOrigin(this.tmpVec[1]),a.setRotation(this.tmpQuaternion[1]),n=new Ammo.btSliderConstraint(r,o,s,a)
}i=this.constraints.push(n)-1,this.dynamicsWorld.addConstraint(n),n.enableFeedback(),"function"==typeof e&&e(i)}},SliderConstraint_setLowerLinLimit:function(t){var e=this.constraints[t.constraintId];e&&e.setLowerLinLimit(t.limit)},SliderConstraint_setUpperLinLimit:function(t){var e=this.constraints[t.constraintId];e&&e.setUpperLinLimit(t.limit)},SliderConstraint_setLowerAngLimit:function(t){var e=this.constraints[t.constraintId];e&&e.setLowerAngLimit(t.limit)},SliderConstraint_setUpperAngLimit:function(t){var e=this.constraints[t.constraintId];e&&e.setUpperAngLimit(t.limit)},HingeConstraint_create:function(t,e){var n,i,r=this.bodies[t.rigidBodyIdA],o="undefined"!=typeof t.rigidBodyIdB&&this.bodies[t.rigidBodyIdB];r&&(this.tmpVec[0].setX(t.pivotA.x),this.tmpVec[0].setY(t.pivotA.y),this.tmpVec[0].setZ(t.pivotA.z),this.tmpVec[1].setX(t.axisA.x),this.tmpVec[1].setX(t.axisA.y),this.tmpVec[1].setX(t.axisA.z),o?(o=this.bodies[t.rigidBodyIdB],this.tmpVec[2].setX(t.pivotB.x),this.tmpVec[2].setY(t.pivotB.y),this.tmpVec[2].setZ(t.pivotB.z),this.tmpVec[3].setX(t.axisB.x),this.tmpVec[3].setY(t.axisB.y),this.tmpVec[3].setZ(t.axisB.z),n=new Ammo.btHingeConstraint(r,o,this.tmpVec[0],this.tmpVec[2],this.tmpVec[1],this.tmpVec[3])):n=new Ammo.btHingeConstraint(r,o,this.tmpVec[0],this.tmpVec[1]),i=this.constraints.push(n)-1,this.dynamicsWorld.addConstraint(n),n.enableFeedback(),"function"==typeof e&&e(i))},HingeConstraint_setLimit:function(t){var e=this.constraints[t.constraintId];e&&e.setLimit(t.low,t.high,t.softness,t.biasFactor,t.relaxationFactor)},DynamicsWorld_rayTestClosest:function(t,e){this.tmpVec[0].setX(t.rayFromWorld.x),this.tmpVec[0].setY(t.rayFromWorld.y),this.tmpVec[0].setZ(t.rayFromWorld.z),this.tmpVec[1].setX(t.rayToWorld.x),this.tmpVec[1].setY(t.rayToWorld.y),this.tmpVec[1].setZ(t.rayToWorld.z);var n=new Ammo.ClosestRayResultCallback(this.tmpVec[0],this.tmpVec[1]);if(this.dynamicsWorld.rayTest(this.tmpVec[0],this.tmpVec[1],n),n.hasHit()){var i=Ammo.castObject(n.get_m_collisionObject(),Ammo.btRigidBody);i.id&&"function"==typeof e&&e({type:"btRigidBody",bodyId:i.id,hitPointWorld:{x:n.get_m_hitPointWorld().x(),y:n.get_m_hitPointWorld().y(),z:n.get_m_hitPointWorld().z()},hitNormalWorld:{x:n.get_m_hitNormalWorld().x(),y:n.get_m_hitNormalWorld().y(),z:n.get_m_hitNormalWorld().z()}})}else"function"==typeof e&&e();Ammo.destroy(n)},DynamicsWorld_addRigidBody:function(t){var e=this.bodies[t.bodyId];e&&this.dynamicsWorld.addRigidBody(e,t.group,t.mask)},DynamicsWorld_addGhostObject:function(t){var e=this.ghosts[t.ghostId];e&&this.dynamicsWorld.addCollisionObject(e,t.group,t.mask)},GhostObject_create:function(t,e){var n,i=this._createShape(t.shape),r=this.tmpVec[0],o=this.tmpQuaternion[0];if(!i)return console.error("Invalid collision shape!");this.tmpTrans[0].setIdentity(),r.setX(t.position.x),r.setY(t.position.y),r.setZ(t.position.z),o.setX(t.quaternion.x),o.setY(t.quaternion.y),o.setZ(t.quaternion.z),o.setW(t.quaternion.w),this.tmpTrans[0].setOrigin(r),this.tmpTrans[0].setRotation(o),n=new Ammo.btPairCachingGhostObject,n.setWorldTransform(this.tmpTrans[0]),n.setCollisionShape(i),n.setCollisionFlags(this.collisionFlags.CF_NO_CONTACT_RESPONSE);var s=this.ghosts.push(n)-1;n.id=s,"function"==typeof e&&e(s)},RigidBody_create:function(t,e){var n,i,r,o,s=this.tmpTrans[0],a=0!==t.mass,c=this.tmpVec[0],u=this.tmpVec[1],l=this.tmpQuaternion[0];if(s.setIdentity(),c.setZero(),n=this._createShape(t.shape),!n)throw"Invalid collision shape!";a&&n.calculateLocalInertia(t.mass,c),u.setX(t.position.x),u.setY(t.position.y),u.setZ(t.position.z),l.setX(t.quaternion.x),l.setY(t.quaternion.y),l.setZ(t.quaternion.z),l.setW(t.quaternion.w),s.setOrigin(u),s.setRotation(l),i=new Ammo.btDefaultMotionState(s),r=new Ammo.btRigidBodyConstructionInfo(t.mass,i,n,c),o=new Ammo.btRigidBody(r);var h=this.bodies.push(o)-1;o.id=h,"function"==typeof e&&e(h)},RigidBody_setType:function(t){var e=this.bodies[t.bodyId];if(e)switch(t.type){case"static":e.setCollisionFlags(this.collisionFlags.CF_STATIC_OBJECT),e.setActivationState(this.activationStates.DISABLE_SIMULATION);break;case"kinematic":e.setCollisionFlags(this.collisionFlags.CF_KINEMATIC_OBJECT),e.setActivationState(this.activationStates.DISABLE_DEACTIVATION);break;default:console.warn("unknown body type: "+t.type+", defaulting to dynamic"),e.setCollisionFlags(0);break;case"dynamic":e.setCollisionFlags(0)}},RigidBody_setWorldTransform:function(t){var e,n,i=this.bodies[t.bodyId];i&&(this.tmpTrans[0].setIdentity(),i.getMotionState().getWorldTransform(this.tmpTrans[0]),e=this.tmpTrans[0].getOrigin(),n=this.tmpTrans[0].getRotation(),e.setX(t.position.x),e.setY(t.position.y),e.setZ(t.position.z),n.setX(t.rotation.x),n.setY(t.rotation.y),n.setZ(t.rotation.z),n.setW(t.rotation.w),i.isKinematicObject()?i.getMotionState().setWorldTransform(this.tmpTrans[0]):i.setWorldTransform(this.tmpTrans[0]))},RigidBody_clearForces:function(t){var e=this.bodies[t.bodyId];e&&(e.clearForces(),e.activate())},RigidBody_applyForce:function(t){var e=this.bodies[t.bodyId];e&&(this.tmpVec[0].setX(t.force.x),this.tmpVec[0].setY(t.force.y),this.tmpVec[0].setZ(t.force.z),this.tmpVec[1].setX(t.relativePosition.x),this.tmpVec[1].setY(t.relativePosition.y),this.tmpVec[1].setZ(t.relativePosition.z),e.applyForce(this.tmpVec[0],this.tmpVec[1]),e.activate())},RigidBody_applyImpulse:function(t){var e=this.bodies[t.bodyId];e&&(this.tmpVec[0].setX(t.impulse.x),this.tmpVec[0].setY(t.impulse.y),this.tmpVec[0].setZ(t.impulse.z),this.tmpVec[1].setX(t.relativePosition.x),this.tmpVec[1].setY(t.relativePosition.y),this.tmpVec[1].setZ(t.relativePosition.z),e.applyImpulse(this.tmpVec[0],this.tmpVec[1]),e.activate())},RigidBody_applyTorque:function(t){var e=this.bodies[t.bodyId];e&&(this.tmpVec[0].setX(t.torque.x),this.tmpVec[0].setY(t.torque.y),this.tmpVec[0].setZ(t.torque.z),e.applyTorque(this.tmpVec[0]),e.activate())},RigidBody_setRestitution:function(t){var e=this.bodies[t.bodyId];e&&e.setRestitution(t.restitution)},RigidBody_setFriction:function(t){var e=this.bodies[t.bodyId];e&&e.setFriction(t.friction)},RigidBody_setDamping:function(t){var e=this.bodies[t.bodyId];e&&e.setDamping(t.linearDamping,t.angularDamping)},RigidBody_setLinearFactor:function(t){var e=this.bodies[t.bodyId];e&&(this.tmpVec[0].setX(t.linearFactor.x),this.tmpVec[0].setY(t.linearFactor.y),this.tmpVec[0].setZ(t.linearFactor.z),e.setLinearFactor(this.tmpVec[0]))},RigidBody_setAngularFactor:function(t){var e=this.bodies[t.bodyId];e&&(this.tmpVec[0].setX(t.angularFactor.x),this.tmpVec[0].setY(t.angularFactor.y),this.tmpVec[0].setZ(t.angularFactor.z),e.setAngularFactor(this.tmpVec[0]))},RigidBody_setLinearVelocity:function(t){var e=this.bodies[t.bodyId];e&&(this.tmpVec[0].setX(t.linearVelocity.x),this.tmpVec[0].setY(t.linearVelocity.y),this.tmpVec[0].setZ(t.linearVelocity.z),e.setLinearVelocity(this.tmpVec[0]))},RigidBody_setAngularVelocity:function(t){var e=this.bodies[t.bodyId];e&&(this.tmpVec[0].setX(t.angularVelocity.x),this.tmpVec[0].setY(t.angularVelocity.y),this.tmpVec[0].setZ(t.angularVelocity.z),e.setAngularVelocity(this.tmpVec[0]))},Constraint_destroy:function(t){var e=this.constraints[t];e&&(this.dynamicsWorld.removeConstraint(e),Ammo.destroy(e),this.constraints[t]=void 0,this.trigger("Constraint_destroy",t))},RigidBody_destroy:function(t){var e=this.bodies[t];e&&(this.dynamicsWorld.removeRigidBody(e),Ammo.destroy(e),this.bodies[t]=void 0,this.trigger("RigidBody_destroy",t))},Vehicle_destroy:function(t){var e=this.vehicles[t];e&&(this.dynamicsWorld.removeVehicle(e),Ammo.destroy(e),this.vehicles[t]=void 0,this.trigger("Vehicle_destroy",t))},GhostObject_destroy:function(t){var e=this.ghosts[t];e&&(this.dynamicsWorld.removeCollisionObject(e),Ammo.destroy(e),this.ghosts[t]=void 0,this.trigger("GhostObject_destroy",t))},shutdown:function(){Ammo.destroy(this.collisionConfiguration),Ammo.destroy(this.dispatcher),Ammo.destroy(this.overlappingPairCache),Ammo.destroy(this.solver)}},t}),n("ammo_rigid_body",[],function(){function t(t,e){this.proxy=t,this.bodyId=e,this.binding=void 0,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:1},this.linearVelocity={x:0,y:0,z:0},this.angularVelocity={x:0,y:0,z:0}}return t.prototype.update=function(){this.binding&&this.binding.update&&this.binding.update()},t.prototype.setType=function(t){return this.proxy.execute("RigidBody_setType",{bodyId:this.bodyId,type:t})},t.prototype.setDamping=function(t,e){return this.proxy.execute("RigidBody_setDamping",{bodyId:this.bodyId,linearDamping:t,angularDamping:e})},t.prototype.applyTorque=function(t){return this.proxy.execute("RigidBody_applyTorque",{bodyId:this.bodyId,torque:{x:t.x,y:t.y,z:t.z}})},t.prototype.applyForce=function(t,e){return this.proxy.execute("RigidBody_applyForce",{bodyId:this.bodyId,force:t,relativePosition:e||{x:0,y:0,z:0}})},t.prototype.applyCentralForce=function(t){return this.proxy.execute("RigidBody_applyCentralForce",{bodyId:this.bodyId,force:{x:t.x,y:t.y,z:t.z}})},t.prototype.applyImpulse=function(t,e){return this.proxy.execute("RigidBody_applyImpulse",{bodyId:this.bodyId,impulse:{x:t.x,y:t.y,z:t.z},relativePosition:e&&{x:e.x,y:e.y,z:e.z}||{x:0,y:0,z:0}})},t.prototype.applyCentralImpulse=function(t){return this.proxy.execute("RigidBody_applyCentralImpulse",{bodyId:this.bodyId,impulse:{x:t.x,y:t.y,z:t.z}})},t.prototype.setFriction=function(t){return this.proxy.execute("RigidBody_setFriction",{bodyId:this.bodyId,friction:t})},t.prototype.setRestitution=function(t){return this.proxy.execute("RigidBody_setRestitution",{bodyId:this.bodyId,restitution:t})},t.prototype.setLinearFactor=function(t){return this.proxy.execute("RigidBody_setLinearFactor",{bodyId:this.bodyId,linearFactor:{x:t.x,y:t.y,z:t.z}})},t.prototype.setAngularFactor=function(t){return this.proxy.execute("RigidBody_setAngularFactor",{bodyId:this.bodyId,angularFactor:{x:t.x,y:t.y,z:t.z}})},t.prototype.setLinearVelocity=function(t){return this.proxy.execute("RigidBody_setLinearVelocity",{bodyId:this.bodyId,linearVelocity:{x:t.x,y:t.y,z:t.z}})},t.prototype.setAngularVelocity=function(t){return this.proxy.execute("RigidBody_setAngularVelocity",{bodyId:this.bodyId,angularVelocity:{x:t.x,y:t.y,z:t.z}})},t.prototype.destroy=function(){var t=this.proxy.execute("RigidBody_destroy",{bodyId:this.bodyId});return this.bodyId=void 0,this.binding.destroy(),t},t.prototype.addToWorld=function(t,e){return this.proxy.execute("DynamicsWorld_addRigidBody",{bodyId:this.bodyId,group:t,mask:e})},t.prototype.setWorldTransform=function(t,e){return this.proxy.execute("RigidBody_setWorldTransform",{bodyId:this.bodyId,position:t,rotation:e})},t.prototype.clearForces=function(){return this.proxy.execute("RigidBody_clearForces",{bodyId:this.bodyId})},t}),n("ammo_vehicle",["underscore"],function(t){function e(t,e,n){this.proxy=t,this.vehicleId=e,this.wheelBindings=[],this.rigidBody=n}return e.prototype.addWheel=function(t,e,n,i,r,o,s){var a={vehicleId:this.vehicleId,connectionPoint:t,wheelDirection:e,wheelAxle:n,suspensionRestLength:i,wheelRadius:r,isFrontWheel:o,tuning:s};return this.proxy.execute("Vehicle_addWheel",a)},e.prototype.setWheelInfo=function(t,e){var n={vehicleId:this.vehicleId,wheelIndex:t,properties:e};return this.proxy.execute("Vehicle_setWheelInfo",n)},e.prototype.setBrake=function(t,e){var n={vehicleId:this.vehicleId,wheelIndex:t,brake:e};return this.proxy.execute("Vehicle_setBrake",n)},e.prototype.applyEngineForce=function(t,e){var n={vehicleId:this.vehicleId,wheelIndex:t,force:e};return this.proxy.execute("Vehicle_applyEngineForce",n)},e.prototype.setSteeringValue=function(t,e){var n={vehicleId:this.vehicleId,wheelIndex:t,steeringValue:e};return this.proxy.execute("Vehicle_setSteeringValue",n)},e.prototype.destroy=function(){var e={vehicleId:this.vehicleId};return t.each(this.wheelBindings,function(t){t.destroy()}),this.rigidBody.destroy(),this.proxy.execute("Vehicle_destroy",e)},e.prototype.addWheelObject=function(t,e){this.wheelBindings[t]=this.proxy.adapter.createBinding(e,this.proxy.getWheelOffset(this.vehicleId,t))},e.prototype.update=function(){this.rigidBody&&this.rigidBody.update(),t.each(this.wheelBindings,function(t){t.update()})},e}),n("ammo_point2point_constraint",[],function(){function t(t,e){this.proxy=t,this.constraintId=e}return t}),n("ammo_hinge_constraint",[],function(){function t(t,e){this.proxy=t,this.constraintId=e}return t.prototype.setLimit=function(t,e,n,i,r){var o={constraintId:this.constraintId,low:t,high:e,softness:n,biasFactor:i,relaxationFactor:r};return this.proxy.execute("HingeConstraint_setLimit",o)},t}),n("ammo_slider_constraint",[],function(){function t(t,e){this.proxy=t,this.constraintId=e}return t.prototype.setLowerLinLimit=function(t){return this.proxy.execute("SliderConstraint_setLowerLinLimit",{constraintId:this.constraintId,limit:t})},t.prototype.setUpperLinLimit=function(t){return this.proxy.execute("SliderConstraint_setUpperLinLimit",{constraintId:this.constraintId,limit:t})},t.prototype.setLowerAngLimit=function(t){return this.proxy.execute("SliderConstraint_setLowerAngLimit",{constraintId:this.constraintId,limit:t})},t.prototype.setUpperAngLimit=function(t){return this.proxy.execute("SliderConstraint_setUpperAngLimit",{constraintId:this.constraintId,limit:t})},t}),n("ammo_ghost_object",[],function(){function t(t,e){this.proxy=t,this.ghostId=e}return t.prototype.addToWorld=function(t,e){return this.proxy.execute("DynamicsWorld_addGhostObject",{ghostId:this.ghostId,group:t,mask:e})},t.prototype.destroy=function(){return this.proxy.execute("GhostObject_destroy",{ghostId:this.ghostId})},t}),n("three/three_binding",[],function(){function t(t,e,n){this.proxy=t,this.object=e,this.offset=n,e.matrixAutoUpdate=!1,e.updateMatrixWorld(),this.originalScale=new THREE.Vector3,this.originalScale.getScaleFromMatrix(e.matrixWorld)}var e=new THREE.Quaternion,n=new THREE.Vector3;return t.prototype.update=function(){this.object&&this.proxy&&this.proxy.data&&(n.x=this.proxy.data[this.offset+0],n.y=this.proxy.data[this.offset+1],n.z=this.proxy.data[this.offset+2],e.x=this.proxy.data[this.offset+3],e.y=this.proxy.data[this.offset+4],e.z=this.proxy.data[this.offset+5],e.w=this.proxy.data[this.offset+6],this.object.matrixWorld.makeRotationFromQuaternion(e),this.object.matrixWorld.scale(this.originalScale),this.object.matrixWorld.setPosition(n))},t.prototype.destroy=function(){this.object=void 0,this.offset=void 0},t}),n("three/three_adapter",["underscore","three/three_binding"],function(t,e){function n(t){this.proxy=t}return n.prototype.createBinding=function(t,n){return new e(this.proxy,t,n)},n.prototype.createRigidBodyFromObject=function(e,n,i){i?"auto"===i.shape&&(i=this._getShapeJSON(e,{strategy:i.strategy})):i=this._getShapeJSON(e);var r={x:e.position.x,y:e.position.y,z:e.position.z},o={x:e.quaternion.x,y:e.quaternion.y,z:e.quaternion.z,w:e.quaternion.w},s=this.proxy.createRigidBody(i,n,r,o);return s.then(t.bind(function(t){t.binding=this.createBinding(e,this.proxy.getRigidBodyOffset(t.bodyId))},this)),s},n.prototype._getShapeJSON=function(t,e){switch(e=e||{},e.strategy=e.strategy||"convex_hull_mesh",e.strategy){case"compound_bounding_box":return this._createBoundingBoxCompoundShape(t);case"bvh_triangle_mesh":return this._createBvhTriangleMeshShape(t);case"convex_triangle_mesh":return this._createConvexTriangleMeshShape(t);case"convex_hull_mesh":return this._createConvexHullMeshShape(t);default:throw new Error("Unknown strategy: "+e.strategy)}},n.prototype._createConvexTriangleMeshShape=function(t){var e={shape:"convex_triangle_mesh",triangles:[]};return this._createTriangleMeshShape(t,e)},n.prototype._createBvhTriangleMeshShape=function(t){var e={shape:"bvh_triangle_mesh",triangles:[]};return this._createTriangleMeshShape(t,e)},n.prototype._createBoundingBoxCompoundShape=function(t){var e=new THREE.Matrix4,n=new THREE.Matrix4,i={shape:"compound",children:[]};return e.getInverse(t.matrixWorld),t.traverse(function(t){if(t instanceof THREE.Mesh&&!t.isBB){var r,o,s=new THREE.Vector3,a=new THREE.Vector3,c=new THREE.Quaternion,u=new THREE.Vector3;u.getScaleFromMatrix(t.matrixWorld),n.copy(e),n.multiply(t.matrixWorld),a.getPositionFromMatrix(n),n.extractRotation(n),c.setFromRotationMatrix(n),t.geometry.computeBoundingBox(),r=t.geometry.boundingBox.min.clone(),o=t.geometry.boundingBox.max.clone(),s.subVectors(o,r),s.multiplyScalar(.5),s.multiplyVectors(s,u);var l=new THREE.Vector3;l.x=(r.x+o.x)/2,l.y=(r.y+o.y)/2,l.z=(r.z+o.z)/2,l.multiplyVectors(l,u),i.children.push({shape:"box",halfExtents:{x:s.x,y:s.y,z:s.z},localTransform:{position:{x:a.x,y:a.y,z:a.z},rotation:{x:c.x,y:c.y,z:c.z,w:c.w}}})}}),i},n.prototype._createConvexHullMeshShape=function(t){var e={shape:"convex_hull_mesh",vertices:[]},n=0,i=new THREE.Matrix4,r=new THREE.Matrix4;return i.getInverse(t.matrixWorld),t.traverse(function(o){var s,a=o.geometry,c=new THREE.Vector3,u=new THREE.Vector3;if(r.copy(i),r.multiply(o.matrixWorld),o instanceof THREE.Mesh&&!o.isBB)if(c.getScaleFromMatrix(o.matrixWorld),a instanceof THREE.BufferGeometry){if(!a.attributes.position.array)return console.warn("BufferGeometry has no position attribute. Was it unloaded?");var l=a.attributes.position.array;for(s=0;s<l.length;s+=3)u.x=l[s+0],u.y=l[s+1],u.z=l[s+2],u.applyMatrix4(r),u.multiply(t.scale),e.vertices[9*n+0]=u.x,e.vertices[9*n+1]=u.y,e.vertices[9*n+2]=u.z,n++}else if(a instanceof THREE.Geometry)for(s=0;s<a.vertices.length;s++)u.copy(a.vertices[s]),u.applyMatrix4(r),u.multiply(t.scale),e.vertices[3*n+0]=u.x,e.vertices[3*n+1]=u.y,e.vertices[3*n+2]=u.z,n++}),e},n.prototype._createTriangleMeshShape=function(t,e){var n,i,r,o,s=new THREE.Matrix4,a=new THREE.Matrix4,c=new THREE.Vector3,u=0;return s.getInverse(t.matrixWorld),t.traverse(function(l){if(l instanceof THREE.Mesh&&!l.isBB)if(i=l.geometry,n=l,a.copy(s),a.multiply(l.matrixWorld),i instanceof THREE.BufferGeometry){if(!i.attributes.position.array)return console.warn("BufferGeometry has no position attribute. Was it unloaded?");for(var h,p,f,d,m=i.attributes.position.array,y=i.attributes.index.array,g=i.offsets,v=0,x=g.length;x>v;++v){var b=g[v].start,_=g[v].count,w=g[v].index;for(r=b,d=b+_;d>r;r+=3)h=w+y[r+0],p=w+y[r+1],f=w+y[r+2],c.x=m[3*h],c.y=m[3*h+1],c.z=m[3*h+2],c.applyMatrix4(a),c.multiply(t.scale),e.triangles[9*u+0]=c.x,e.triangles[9*u+1]=c.y,e.triangles[9*u+2]=c.z,c.x=m[3*p],c.y=m[3*p+1],c.z=m[3*p+2],c.applyMatrix4(a),c.multiply(t.scale),e.triangles[9*u+3]=c.x,e.triangles[9*u+4]=c.y,e.triangles[9*u+5]=c.z,c.x=m[3*f],c.y=m[3*f+1],c.z=m[3*f+2],c.applyMatrix4(a),c.multiply(t.scale),e.triangles[9*u+6]=c.x,e.triangles[9*u+7]=c.y,e.triangles[9*u+8]=c.z,u++}}else if(i instanceof THREE.Geometry)for(r=0;r<i.faces.length;r++)o=i.faces[r],c.copy(i.vertices[o.a]),c.applyMatrix4(a),c.multiply(t.scale),e.triangles[9*u+0]=c.x,e.triangles[9*u+1]=c.y,e.triangles[9*u+2]=c.z,c.copy(i.vertices[o.b]),c.applyMatrix4(a),c.multiply(t.scale),e.triangles[9*u+3]=c.x,e.triangles[9*u+4]=c.y,e.triangles[9*u+5]=c.z,c.copy(i.vertices[o.c]),c.applyMatrix4(a),c.multiply(t.scale),e.triangles[9*u+6]=c.x,e.triangles[9*u+7]=c.y,e.triangles[9*u+8]=c.z,u++}),e},n}),n("ammo_proxy",["when","underscore","ammo_worker_api","ammo_rigid_body","ammo_vehicle","ammo_point2point_constraint","ammo_hinge_constraint","ammo_slider_constraint","ammo_ghost_object","three/three_adapter"],function(t,e,n,i,r,o,s,a,c,u){function l(t){function i(t){o[t]=function(){return o.worker[t].apply(o.worker,arguments)}}var r,o=this,s=["on","fire","setStep","setIterations","setGravity","startSimulation","stopSimulation","getStats"];t=this.opts=t||{},t.gravity=t.gravity||{x:0,y:-9.82,z:0},t.iterations=t.iterations||10,t.step=t.step||1/60,t.maxBodies=t.maxBodies||1e3,t.maxVehicles=t.maxVehicles||32,t.maxWheelsPerVehicle=t.maxWheelsPerVehicle||8;var a=this.bodies=[],c=this.constraints=[],l=this.vehicles=[],h=this.ghosts=[];this.adapter=new u(this),this.worker=cw(new n(t)),this.worker.on("update",e.bind(this.update,this)),this.worker.on("error",function(t){console.error(t.message)}),this.worker.on("GhostObject_destroy",function(t){h[t]=void 0}),this.worker.on("RigidBody_destroy",function(t){a[t]=void 0}),this.worker.on("Vehicle_destroy",function(t){l[t]=void 0}),this.worker.on("Constraints_destroy",function(t){c[t]=void 0});for(r in s)s.hasOwnProperty(r)&&i(s[r]);this.setStep(t.step),this.setIterations(t.iterations),this.setGravity(t.gravity)}return l.prototype.execute=function(t,e){return this.worker[t](e)},l.prototype.aabbTest=function(t,e){return this.execute("Broadphase_aabbTest",{min:{x:t.x,y:t.y,z:t.z},max:{x:e.x,y:e.y,z:e.z}})},l.prototype.rayTestClosest=function(t,e){return this.execute("DynamicsWorld_rayTestClosest",{rayFromWorld:t,rayToWorld:e})},l.prototype.createVehicle=function(n,o){var s={bodyId:n instanceof i?n.bodyId:n,tuning:o},a=t.defer();return this.worker.Vehicle_create(s).then(e.bind(function(t){var e=this;setTimeout(function(){var i=new r(e,t,n);e.vehicles[t]=i,a.resolve(i)},0)},this)),a.promise},l.prototype.createGhostObject=function(n,i,r){var o={shape:n,position:i,quaternion:r},s=t.defer();return this.worker.GhostObject_create(o).then(e.bind(function(t){var e=this;setTimeout(function(){var n=new c(e,t);e.ghosts[t]=n,s.resolve(n)},0)},this)),s.promise},l.prototype.createRigidBody=function(n,r,o,s){var a={shape:n,mass:r,position:o,quaternion:s},c=t.defer();return this.worker.RigidBody_create(a).then(e.bind(function(t){var e=this;setTimeout(function(){var n=new i(e,t);e.bodies[t]=n,c.resolve(n)},0)},this)),c.promise},l.prototype.createPoint2PointConstraint=function(n,i,r,s){var a={rigidBodyIdA:n.bodyId,rigidBodyIdB:i.bodyId,pivotA:{x:r.x,y:r.y,z:r.z},pivotB:{x:s.x,y:s.y,z:s.z}},c=t.defer();return this.execute("Point2PointConstraint_create",a).then(e.bind(function(t){var e=this;setTimeout(function(){var n=new o(e,t);e.constraints[t]=n,c.resolve(n)},0)},this)),c.promise},l.prototype.createSliderConstraint=function(n,i,r,o){var s={rigidBodyIdA:n.bodyId,rigidBodyIdB:i.bodyId,frameInA:{position:{x:r.position.x,y:r.position.y,z:r.position.z},rotation:{x:r.rotation.x,y:r.rotation.y,z:r.rotation.z,w:r.rotation.w}},frameInB:{position:{x:o.position.x,y:o.position.y,z:o.position.z},rotation:{x:o.rotation.x,y:o.rotation.y,z:o.rotation.z,w:o.rotation.w}}},c=t.defer();return this.execute("SliderConstraint_create",s).then(e.bind(function(t){var e=this;setTimeout(function(){var n=new a(e,t);e.constraints[t]=n,c.resolve(n)},0)},this)),c.promise},l.prototype.createHingeConstraint=function(n,i,r,o,a,c){var u={rigidBodyIdA:n.bodyId,rigidBodyIdB:i.bodyId,pivotA:{x:r.x,y:r.y,z:r.z},pivotB:{x:o.x,y:o.y,z:o.z},axisA:{x:a.x,y:a.y,z:a.z},axisB:{x:c.x,y:c.y,z:c.z}},l=t.defer();return this.execute("HingeConstraint_create",u).then(e.bind(function(t){var e=this;setTimeout(function(){var n=new s(e,t);e.constraints[t]=n,l.resolve(n)},0)},this)),l.promise},l.prototype.update=function(t){this.next&&(this.worker.swap(this.data&&this.data.buffer),this.data=this.next),this.next=new Float64Array(t)},l.prototype.createRigidBodyFromObject=function(t,e,n){return this.adapter.createRigidBodyFromObject(t,e,n)},l.prototype.getRigidBodyOffset=function(t){return 7*t},l.prototype.getWheelOffset=function(t,e){return 7*this.opts.maxBodies+7*8*t+7*e},l.prototype.getVehicle=function(t){return this.vehicles[t]?this.vehicles[t]:(console.warn("Asked for non-existent vehicle with ID: "+t),void 0)},l.prototype.getConstraint=function(t){return this.constraints[t]?this.constraints[t]:(console.warn("Asked for non-existent constraint with ID: "+t),void 0)},l.prototype.getRigidBody=function(t){return this.bodies[t]?this.bodies[t]:(console.warn("Asked for non-existent rigid body with ID: "+t),void 0)},l.prototype.getGhostObject=function(t){return this.ghosts[t]?this.ghosts[t]:(console.warn("Asked for non-existent ghost object with ID: "+t),void 0)},l}),e("ammo_proxy")});